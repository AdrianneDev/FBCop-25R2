<template>
	<require from="./style.scss"></require>
	<qp-template id="ServiceOrderRecords_mainForm" name="7-10-7" class="equal-height" qp-collapsible wg-container>
		<qp-fieldset id="first" slot="A" view.bind="ServiceOrderRecords">
			<field name="SrvOrdType" config-allow-edit.bind="true"></field>
			<field name="RefNbr"></field>
			<field name="Status" class="colored"></field>
			<field name="OrderDate"></field>
			<field name="CustPORefNbr"></field>
			<field name="CustWorkOrderRefNbr"></field>
		</qp-fieldset>
		<qp-fieldset id="second" slot="B" view.bind="ServiceOrderRecords">
			<field name="CustomerID" config-allow-edit.bind="true" class="default-control"></field>
			<field name="LocationID" config-allow-edit.bind="true"></field>
			<field name="CuryID" control-type="qp-currency" view.bind="currencyinfo"></field>
			<field name="ProjectID" config-allow-edit.bind="true"></field>
			<field name="DfltProjectTaskID"></field>
			<field name="DocDesc" config-type.bind="1" config-rows.bind="2"></field>
		</qp-fieldset>
		<qp-fieldset id="summary" slot="C" view.bind="ServiceOrderRecords" class="highlights-section">
			<field name="EstimatedDurationTotal"></field>
			<field name="CuryEstimatedBillableTotal"></field>
			<field name="CuryTaxTotal"></field>
			<field name="CuryDocTotal"></field>
			<field name="CuryEffectiveBillableDocTotal"></field>
		</qp-fieldset>
	</qp-template>
	<qp-tabbar id="CurrentServiceOrder_tab" wg-container>
		<qp-tab caption="Settings" id="settingsTab">
			<qp-template id="SettingsTemplate" name="17-17-14">
				<div slot="A">
					<qp-include url="src/screens/common/form-contact-document/form-contact-document.html"
								fs-id="ServiceOrder_Contact_edServiceOrder_Contact"
								fs-wg-container
								contact-view="ServiceOrder_Contact"
								fs-caption="Contact">
						<field before="#ServiceOrder_Contact_edServiceOrder_Contact [name='FullName']" name="CurrentServiceOrder.ContactID" wg-container="CurrentServiceOrder_edContactForm"></field>
					</qp-include>
					<qp-include url="src/screens/common/form-address/form-address.html"
								fs-id="ServiceOrder_Address_edServiceOrder_Address"
								fs-wg-container
								address-view="ServiceOrder_Address"
								fs-caption="Address"
								with-coordinates="true"
								with-validation="false">
						<field before="#ServiceOrder_Address_edServiceOrder_Address [name='AddressLine1']" name="CurrentServiceOrder.RoomID" wg-container="CurrentServiceOrder_edRoomForm"></field>
					</qp-include>
				</div>
				<div slot="B">
					<qp-fieldset id="CurrentServiceOrder_20" caption="Workflow" view.bind="ServiceOrderRecords" wg-container="ServiceOrderRecords_mainForm">
						<field name="WFStageID" config-allow-edit.bind="true"></field>
						<field name="WaitingForParts"></field>
						<field name="AppointmentsNeeded"></field>
						<field name="IsPrepaymentEnable"></field>
						<field name="ShowInvoicesTab"></field>
					</qp-fieldset>
					<qp-fieldset id="CurrentServiceOrder_30" caption="Service Settings" view.bind="CurrentServiceOrder">
						<using wg-container="ServiceOrderRecords_mainForm" view="ServiceOrderRecords">
							<field name="BranchLocationID" config-allow-edit.bind="true"></field>
							<field name="BillServiceContractID" config-allow-edit.bind="true"></field>
							<field name="BillContractPeriodID"></field>
						</using>
						<field name="AssignedEmpID"></field>
						<field name="ProblemID" config-allow-edit.bind="true"></field>
						<field name="Severity"></field>
						<field name="Priority"></field>
						<field name="SLAETA_Date">
							<qp-field control-state.bind="CurrentServiceOrder.SLAETA_Time" config-time-mode.bind="true" config-enabled.bind="false">
							</qp-field>
						</field>
					</qp-fieldset>
					<qp-fieldset id="CurrentServiceOrder_SourceInfoForm" wg-container caption="Source Info" view.bind="CurrentServiceOrder">
						<field name="SourceType"></field>
						<field name="SourceReferenceNbr" config-link-command.bind="'OpenSource'"></field>
						<field name="ServiceContractID" config-allow-edit.bind="true"></field>
						<field name="ScheduleIDContainer" unbound>
							<qp-label slot="label" caption.bind="CurrentServiceOrder.ScheduleID.text"></qp-label>
							<qp-text-editor id="edCurrentServiceOrder-ScheduleID" config.bind="{linkCommand: 'OpenScheduleScreen'}" state.bind="CurrentServiceOrder.ScheduleID" value.bind="CurrentServiceOrder.ScheduleID.value.id" wg-name="ScheduleID" class="col-12"></qp-text-editor>
						</field>
						<field name="ScheduleRecord.RecurrenceDescription"></field>
					</qp-fieldset>
				</div>
			</qp-template>
		</qp-tab>
		<qp-tab caption="Details" id="detailsTab">
			<qp-grid id="PXGridDetails" view.bind="ServiceOrderDetails">
			</qp-grid>
		</qp-tab>
		<qp-tab caption="Taxes" id="taxesTab">
			<qp-grid id="gridTaxDetails" view.bind="Taxes">
			</qp-grid>
		</qp-tab>
		<qp-tab caption="Appointments" id="appointmentsTab">
			<qp-grid id="PXGridAppointments" view.bind="ServiceOrderAppointments">
			</qp-grid>
		</qp-tab>
		<qp-tab caption="Financial" id="financialTab">
			<qp-template id="FinancialTemplate" name="17-17-14">
				<qp-fieldset slot="A" id="CurrentServiceOrder_Fin" view.bind="CurrentServiceOrder">
					<field name="BranchID" config-allow-edit.bind="true"></field>
					<field name="BillCustomerID" config-allow-edit.bind="true"></field>
					<field name="BillLocationID" config-allow-edit.bind="true"></field>
					<field name="TaxZoneID" config-allow-edit.bind="true"></field>
					<field name="TaxCalcMode"></field>
					<field name="CurrentServiceOrder.ExternalTaxExemptionNumber"></field>
					<field name="CurrentServiceOrder.EntityUsageType"></field>
					<field name="BillingBy"></field>
					<field name="SalesPersonID"></field>
					<field name="Commissionable"></field>
				</qp-fieldset>
			</qp-template>
		</qp-tab>
		<qp-tab caption="Profitability" id="profitabilityTab" load-on-demand.bind="true">
			<qp-grid id="PXGridProfitability" view.bind="ProfitabilityRecords">
			</qp-grid>
		</qp-tab>
		<qp-tab caption="Default Staff" id="defaultStaffTab">
			<qp-grid id="PXGridStaff" view.bind="ServiceOrderEmployees">
			</qp-grid>
		</qp-tab>
		<qp-tab caption="Default Resource Equipment" id="defaultResourceEquipmentTab">
			<qp-grid id="PXGridResourceEquipment" view.bind="ServiceOrderEquipment">
			</qp-grid>
		</qp-tab>
		<qp-tab caption="Attributes" id="attributesTab">
			<qp-grid id="PXGridAnswers" view.bind="Answers">
			</qp-grid>
		</qp-tab>
		<qp-tab caption="Related Documents" id="relatedDocumentsTab">
			<qp-grid id="PXGridRelatedServiceOrders" view.bind="RelatedServiceOrders">
			</qp-grid>
		</qp-tab>
		<qp-tab caption="Prepayments" id="prepaymentsTab" if.bind="ServiceOrderRecords.IsPrepaymentEnable.value == true">
			<qp-template id="CurrentServiceOrder_PrepaymentTotals" name="17-7" class="stretch full-width" wg-container>
				<qp-grid id="detgrid" slot="A" view.bind="Adjustments">
				</qp-grid>
				<div slot="B">
					<qp-fieldset id="CurrentServiceOrder_40" view.bind="CurrentServiceOrder" caption="Prepayment Summary" class="highlights-section">
						<field name="SOPrepaymentReceived"></field>
						<field name="SOPrepaymentApplied"></field>
						<field name="SOPrepaymentRemaining"></field>
						<field name="SOCuryUnpaidBalanace"></field>
						<field name="SOCuryBillableUnpaidBalanace"></field>
					</qp-fieldset>
				</div>
			</qp-template>
		</qp-tab>
		<qp-tab caption="Totals" id="totalsTab">
			<qp-template id="CurrentServiceOrder_formG" wg-container name="17-17-14">
				<qp-fieldset id="CurrentServiceOrder_serviceOrderTotalsForm" slot="A" view.bind="CurrentServiceOrder" caption="Service Order Totals" class="highlights-section">
					<field name="EstimatedDurationTotal"></field>
					<field name="CuryEstimatedOrderTotal"></field>
					<field name="CuryBillableOrderTotal"></field>
					<field name="CuryTaxTotal"></field>
					<field name="CuryDocTotal"></field>
					<field name="CuryVatExemptTotal"></field>
					<field name="CuryVatTaxableTotal"></field>
					<field name="CuryEffectiveCostTotal"></field>
				</qp-fieldset>
				<div slot="B">
					<qp-fieldset id="CurrentServiceOrder_appointmentTotalsForm" view.bind="CurrentServiceOrder" caption="Appointment Totals" class="highlights-section">
						<field name="ApptDurationTotal"></field>
						<field name="CuryApptOrderTotal"></field>
						<field name="CuryAppointmentTaxTotal"></field>
						<field name="CuryAppointmentDocTotal"></field>
					</qp-fieldset>
					<qp-fieldset id="CurrentServiceOrder_profitRatiosForm" view.bind="CurrentServiceOrder" caption="Profit Ratios" class="highlights-section">
						<field name="ProfitPercent"></field>
						<field name="ProfitMarginPercent"></field>
					</qp-fieldset>
				</div>
			</qp-template>
		</qp-tab>
		<qp-tab caption="Billing Documents" id="billingDocumentsTab" if.bind="ServiceOrderRecords.ShowInvoicesTab.value == true">
			<qp-template id="BillingTemplate" name="17-17-14">
				<qp-fieldset id="CurrentServiceOrder_edInvoiceInfoForm2" wg-container slot="A" view.bind="CurrentServiceOrder" class="no-label">
					<field name="AllowInvoice"></field>
					<field name="Mem_Invoiced"></field>
				</qp-fieldset>
			</qp-template>
			<qp-grid id="PXGridInvoiceRecords" view.bind="InvoiceRecords">
			</qp-grid>
		</qp-tab>
		<qp-tab caption="Other" id="otherTab" wg-container="CurrentServiceOrder_edCommentsForm">
			<qp-rich-text-editor id="edLongDescr" state.bind="CurrentServiceOrder.LongDescr" wg-field class="stretch">
			</qp-rich-text-editor>
		</qp-tab>
	</qp-tabbar>

	<qp-panel id="QuickProcessParameters" caption="Process Service Order" width="lg" auto-repaint="true">
		<qp-template id="QuickProcessParameters_formQuickProcess" name="1-1" class="label-size-m" wg-container>
			<div slot="A">
				<qp-fieldset id="QuickProcessParameters_10" caption="Service Order Actions" view.bind="QuickProcessParameters">
					<field name="AllowInvoiceServiceOrder"></field>
					<field name="CompleteServiceOrder"></field>
					<field name="CloseServiceOrder"></field>
					<field name="GenerateInvoiceFromServiceOrder"></field>
				</qp-fieldset>
				<qp-fieldset id="QuickProcessParameters_20" caption="Sales Order Actions" view.bind="QuickProcessParameters">
					<field name="PrepareInvoice"></field>
					<field name="SOQuickProcess"></field>
					<field name="EmailSalesOrder"></field>
				</qp-fieldset>
			</div>
			<qp-fieldset id="QuickProcessParameters_30" caption="Invoice Actions" slot="B" view.bind="QuickProcessParameters">
				<field name="ReleaseInvoice"></field>
				<field name="EmailInvoice"></field>
			</qp-fieldset>
		</qp-template>
		<footer>
			<qp-button id="btnOK" state.bind="QuickProcessOk" dialog-result="OK"></qp-button>
		</footer>
	</qp-panel>

	<qp-panel id="StaffSelectorFilter" caption="Add Staff" auto-repaint="true" width="lg" height="85vh">
		<qp-template id="StaffSelectorTemplate" name="1-1" class="stretch label-size-m">
			<div slot="A">
				<qp-fieldset id="StaffSelectorFilter_form" view.bind="StaffSelectorFilter">
					<field name="ServiceLineRef"></field>
					<field name="PostalCode"></field>
					<field name="GeoZoneID"></field>
				</qp-fieldset>
				<qp-tabbar id="stafFiltersTabs">
					<qp-tab id="skillsTab" caption="Skills">
						<qp-grid id="PXGridServiceSkills" view.bind="SkillGridFilter" class="framed-section">
						</qp-grid>
					</qp-tab>
					<qp-tab id="licensesTab" caption="Licenses">
						<qp-grid id="PXGridLicenseType" view.bind="LicenseTypeGridFilter" class="framed-section">
						</qp-grid>
					</qp-tab>
				</qp-tabbar>
			</div>
			<qp-grid id="PXGridAvailableStaff" caption="Staff" slot="B" view.bind="StaffRecords" class="framed-section">
			</qp-grid>
		</qp-template>
		<footer>
			<qp-button id="closeStaffSelector" caption="Add" dialog-result="Cancel" wg-name="OK" class="major-button"></qp-button>
		</footer>
	</qp-panel>

	<qp-panel id="ItemInfo" caption="Inventory Lookup" auto-repaint="true" width="lg" height="85vh">
		<qp-template id="ItemFilter_formSitesStatus" name="17-17-14" class="equal-height" wg-container>
			<qp-fieldset id="sitestatusfilterForm1" slot="A" view.bind="ItemFilter">
				<field name="LineType"></field>
				<field name="Inventory"></field>
				<field name="BarCode"></field>
				<field name="SiteID"></field>
				<field name="ItemClass"></field>
				<field name="SubItem"></field>
			</qp-fieldset>
			<qp-fieldset id="sitestatusfilterForm2" slot="B" view.bind="ItemFilter">
				<field name="Mode" control-type="qp-radio"></field>
				<field name="OnlyAvailable"></field>
				<field name="HistoryDate"></field>
			</qp-fieldset>
		</qp-template>
		<qp-grid id="ItemInfo_gripSiteStatus" view.bind="ItemInfo">
		</qp-grid>
		<footer>
			<qp-button id="PXButton5" state.bind="AddSelectedItems"></qp-button>
			<qp-button id="PXButton4" caption="Add & Close" dialog-result="OK"></qp-button>
			<qp-button id="PXButton6" dialog-result="Cancel"></qp-button>
		</footer>
	</qp-panel>

	<qp-panel id="ServiceOrderTypeSelector" caption="Select the New Service Order Type" auto-repaint="true" width="sm">
		<qp-template id="ServiceOrderTypeTemplate" name="1-1" class="label-size-m">
			<qp-fieldset id="ServiceOrderTypeSelector_DriverRouteForm" slot="A" view.bind="ServiceOrderTypeSelector">
				<field name="SrvOrdType"></field>
			</qp-fieldset>
		</qp-template>
		<footer id="PXPanelCopyToServiceOrder">
			<qp-button id="PXButton1" caption="Proceed" dialog-result="OK"></qp-button>
			<qp-button id="PXButton2" dialog-result="Cancel"></qp-button>
		</footer>
	</qp-panel>
</template>
