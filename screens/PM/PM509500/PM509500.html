<template>
	<require from="../PM509000/sp-common.scss"></require>
	<require from="../PM509000/data-feed.scss"></require>
	<require from="../PM509000/tool-bar.scss"></require>

	<qp-template id="filterForm" name="1-1-1" class="label-size-sm" qp-collapsible>
		<qp-fieldset id="filterSlotA" slot="A" view.bind="Filter">
			<field name="ProjectID" pinned="false"></field>
			<field name="Project.Status" pinned="false"></field>
		</qp-fieldset>
		<qp-fieldset id="filterSlotB" slot="B" view.bind="Filter">
			<field name="Project.OwnerID" pinned="false"></field>
			<field name="Project.StartDate" pinned="false"></field>
		</qp-fieldset>
	</qp-template>

	<qp-splitter id="treeSplitterByEntity" initial-split="16%">
		<split-pane>
			<qp-tree id="linkTypeTree" view.bind="ProjectLinkTypes" caption="Record Types"></qp-tree>
		</split-pane>
		<split-pane>
			<qp-splitter id="previewSplitterByEntity"
					initial-split="61%"
					view-model.ref="previewSplitterByEntity"
					initial-state="collapsed-second">
				<split-pane>
					<div class="h-stack section-caption">
						<qp-caption caption="${ProjectLinkTypes.activeRow.TypeName.value}"></qp-caption>
						<div
								class="feed-search-div ${FeedFilter.IsShown.value ? 'filter-used' : ''}"
								click.delegate="toggleFeedFilter()">
							<qp-hyper-icon class="feed-search" images.bind="{ normal: 'svg:main@filter' }"></qp-hyper-icon>
						</div>
					</div>
					<div class="custom-feed-filter" show.bind="FeedFilter.IsShown.value">
						<qp-field control-state.bind="FeedFilter.LinkedDocumentNoteID" class="no-label entity-filter"></qp-field>
						<qp-field
								control-state.bind="FeedFilter.FileName"
								class="no-label custom-search-field file-name-filter"></qp-field>
						<qp-field control-state.bind="FeedFilter.Tag" class="no-label tag-filter"></qp-field>
						<qp-field control-state.bind="FeedFilter.ShowMyFilesOnly" class="no-label"></qp-field>
					</div>
					<qp-text-light-scope>
						<qp-data-feed id="fileListFeedByEntity"
								view.bind="LinkedFilesByEntity"
								class="no-toolbar sp-invoices-feed compact-feed"
								auto-resize="true">
							<template width="100%">
								<div
										class="record-item-compound sp-invoices-invoice no-animation centered-menu clickable-row feed-row ${!!Filter.ActiveFileIDByEntity.value && LinkedFilesByEntity.FileID.value === Filter.ActiveFileIDByEntity.value && LinkedFilesByEntity.LinkedDocumentNoteID.value === Filter.ActiveEntityIDByEntity.value ? 'active-row' : ''}"
										click.delegate="setActiveFileByEntity(LinkedFilesByEntity, $event)">
									<qp-template id="fileFormByEntity1_${$index}" name="record-1" class="col-lg-2" wg-container>
										<qp-fieldset id="slDocType_${$index}" slot="A1" view.bind="LinkedFilesByEntity">
											<field name="LinkedDocumentType" class="text-ellipsis"></field>
										</qp-fieldset>

										<qp-fieldset id="slDocNumber_${$index}"
												slot="A2"
												view.bind="LinkedFilesByEntity"
												click.delegate="openLinkedEntityByEntity(LinkedFilesByEntity, $event)">
											<field name="LinkedDocumentNumber" class="custom-link text-ellipsis"></field>
										</qp-fieldset>
									</qp-template>

									<qp-template id="fileFormByEntity2_${$index}"
											name="record-1"
											class="col-lg-10"
											if.bind="!LinkedFilesByEntity.ShortName.value"
											wg-container>
										<div id="uploadEmpty_${$index}"
											slot="A1"
											class="qp-uploader upload-file-icon"
											click.delegate="uploadLinkedFileByEntity(LinkedFilesByEntity, $event)">
											<qp-hyper-icon images.bind="{ normal: 'svg:main@files' }"></qp-hyper-icon>
											<qp-tooltip>Upload File</qp-tooltip>
										</div>

										<qp-menu
												slot="Postfix"
												class="save-menu"
												config.bind="getFileMenuByEntity(LinkedFilesByEntity)"
												menuselected.delegate="handleFileMenuCommandByEntity(LinkedFilesByEntity, $event)"></qp-menu>
									</qp-template>

									<qp-template id="fileFormByEntity3_${$index}"
											name="record-1"
											class="col-lg-5"
											if.bind="LinkedFilesByEntity.ShortName.value"
											wg-container>
										<qp-image-view
												slot="Prefix"
												state.bind="LinkedFilesByEntity.ImageUrl"
												object-fit="cover"
												height="48px"
												width="48px"
												if.bind="LinkedFilesByEntity.ImageUrl.value"></qp-image-view>
										<qp-hyper-icon
												else
												slot="Prefix"
												class="file-type-icon"
												width="48px"
												images.bind="LinkedFilesByEntity.fileTypeIcon"></qp-hyper-icon>

										<qp-fieldset id="slShortNameE_${$index}"
												slot="A1"
												view.bind="LinkedFilesByEntity"
												if.bind="LinkedFilesByEntity.ShortName.value">
											<field name="ShortName" class="custom-link text-ellipsis field--bold"></field>
										</qp-fieldset>

										<qp-fieldset id="slRevisionE_${$index}"
												slot="A2"
												view.bind="LinkedFilesByEntity"
												if.bind="LinkedFilesByEntity.ShortName.value">
											<field name="Version" class="secondary-text"></field>
											<field name="UploadFileRevisionNoData__ReadableSize" class="secondary-text"></field>
											<field name="UploadFileRevisionNoData__CreatedByID" class="secondary-text"></field>
											<field name="CreationDate" class="secondary-text text-ellipsis"></field>
										</qp-fieldset>
									</qp-template>

									<qp-template id="fileFormByEntity4_${$index}"
											name="record-1"
											class="col-lg-5"
											if.bind="LinkedFilesByEntity.ShortName.value"
											wg-container>
										<div id="slTagsE_${$index}" slot="A1" class="tag-list">
											<qp-hyper-icon
													show.bind="LinkedFilesByEntity.Tags.value && LinkedFilesByEntity.Tags.value.text"
													images.bind="{ normal: 'svg:tags@tag' }"></qp-hyper-icon>
											<qp-field control-state.bind="LinkedFilesByEntity.Tags" class="no-label"></qp-field>
										</div>

										<qp-menu
												slot="Postfix"
												class="save-menu"
												config.bind="getFileMenuByEntity(LinkedFilesByEntity)"
												menuselected.delegate="handleFileMenuCommandByEntity(LinkedFilesByEntity, $event)"></qp-menu>
									</qp-template>
								</div>
							</template>
						</qp-data-feed>
					</qp-text-light-scope>
				</split-pane>
				<split-pane class="v-stack">
					<div class="v-stack" show.bind="ActiveLinkedFileByEntity.Initialized.value">
						<div show.bind="ActiveLinkedFileByEntity.ShortName.value">
							<qp-caption caption="File Details"></qp-caption>
						</div>
						<qp-tool-bar
								class="file-action-tool-bar"
								view-model.ref="detailsToolBarByEntity"
								config.bind="detailsToolBarConfigByEntity"></qp-tool-bar>
						<div id="imagePreviewByEntity"
								show.bind="ActiveLinkedFileByEntity.ImageUrl.value"
								style="margin-bottom: 10px">
							<qp-image-view
									state.bind="ActiveLinkedFileByEntity.ImageUrl"
									object-fit="contain"
									aspect-ratio="auto 4/2.8"></qp-image-view>
						</div>
						<div id="pdfPreviewDiv" style="margin-bottom: 10px">
							<iframe id="pdfPreviewFrame"></iframe>
						</div>
						<qp-tabbar id="tabPreviewByEntity" show.bind="ActiveLinkedFileByEntity.ShortName.value">
							<qp-tab id="fileSummary" caption="Summary">
								<qp-fieldset id="tagsPreviewByEntity" view.bind="ActiveLinkedFileByEntity">
									<field name="ShortName"></field>
									<field name="Tags"></field>
									<field name="CheckedOutBy"></field>
									<field name="CheckedOutComment"></field>
								</qp-fieldset>
							</qp-tab>
							<qp-tab id="fileVersionsByEntity" caption="Versions">
								<qp-text-light-scope>
									<qp-data-feed id="fileVersionFeedByEntity"
											view.bind="ActiveFileVersionsByEntity"
											class="no-toolbar sp-invoices-feed compact-feed"
											auto-resize="true">
										<template width="100%">
											<div
													class="sp-invoices-invoice no-animation ${ActiveFileVersionsByEntity.FileRevisionID.value === Filter.ActiveFileVersionByEntity.value ? 'active-row' : ''}">
												<qp-template id="fileVersionFormByEntity" name="record-1" wg-container>
													<qp-fieldset id="slA1VE"
															slot="A1"
															view.bind="ActiveFileVersionsByEntity"
															click.delegate="setActiveVersionByEntity(ActiveFileVersionsByEntity, $event)">
														<field name="FullVersion" class="custom-link"></field>
														<field name="CreatedByID" config-display-mode.bind="'text'"></field>
													</qp-fieldset>

													<qp-fieldset id="slA2VE"
															slot="A2"
															view.bind="ActiveFileVersionsByEntity"
															class="secondary-text">
														<field name="CreationDate"></field>
														<field name="ReadableSize"></field>
													</qp-fieldset>
												</qp-template>
											</div>
										</template>
									</qp-data-feed>
								</qp-text-light-scope>
							</qp-tab>
							<qp-tab id="fileEntitiesByEntity" caption="Entities">
								<qp-text-light-scope>
									<qp-data-feed id="fileEntitiesFeedByEntity"
											view.bind="ActiveFileLinkedEntitiesByEntity"
											class="no-toolbar sp-invoices-feed compact-feed"
											auto-resize="true">
										<template width="100%">
											<div class="sp-invoices-invoice no-animation">
												<qp-template id="fileEntitiesFormByEntity" name="record-1" wg-container>
													<qp-fieldset id="slA1FEE"
															slot="A1"
															view.bind="ActiveFileLinkedEntitiesByEntity"
															click.delegate="navigateToEntityByEntity(ActiveFileLinkedEntitiesByEntity, $event)">
														<field name="LinkedDocumentType"></field>
														<field name="LinkedDocumentNumber" class="custom-link"></field>
													</qp-fieldset>
												</qp-template>
											</div>
										</template>
									</qp-data-feed>
								</qp-text-light-scope>
							</qp-tab>
							<qp-tab id="fileNoteByEntity" caption="Note">
								<qp-text-editor id="fileNoteEditorByEntity"
										state.bind="ActiveLinkedFileByEntity.NoteText"
										class="col-12"
										fixed-height></qp-text-editor>
							</qp-tab>
						</qp-tabbar>
					</div>
				</split-pane>
			</qp-splitter>
		</split-pane>
	</qp-splitter>

	<qp-upload-dialog id="uploadFilePanel"
			caption="File Upload"
			key="UploadLinkedFilePanel"
			session-key="ProjectEntitiesEntry_UploadLinkedFilePanel"></qp-upload-dialog>

	<qp-panel id="EntityToLinkFilter" caption="Link File to Document" auto-repaint="true" width="xs" height="400px">
		<qp-fieldset id="entityToLinkFilterForm" view.bind="EntityToLinkFilter" class="no-label">
			<field name="LinkType"></field>
		</qp-fieldset>
		<qp-grid id="entitiesToLinkGrid" view.bind="EntitiesToLink"></qp-grid>
		<footer>
			<qp-button id="linkButton" dialog-result="OK" caption="Link"></qp-button>
			<qp-button id="cancelButton" dialog-result="Cancel"></qp-button>
		</footer>
	</qp-panel>

	<qp-panel id="CreateNewTagInPlaceFilter"
			caption="Add Tag"
			class="no-close-panel"
			auto-repaint="true"
			width="sm"
			height="250px">
		<qp-fieldset id="createNewTagInPlaceForm" view.bind="CreateNewTagInPlaceFilter" class="label-size-m">
			<field name="TagName"></field>
			<field name="ParentTagID"></field>
			<field name="AccessTagID"></field>
		</qp-fieldset>
		<footer>
			<qp-button id="okButton" dialog-result="Yes" state.bind="CreateNewTagInPlace" caption="Add"></qp-button>
			<qp-button id="cancelButton" dialog-result="No" caption="Cancel"></qp-button>
		</footer>
	</qp-panel>

	<qp-panel id="CheckoutComment" caption="Check Out File">
		<qp-fieldset id="formCheckOutComment" view.bind="CheckoutComment">
			<field name="Comment"></field>
		</qp-fieldset>
		<footer>
			<qp-button id="PXButton1" dialog-result="OK"></qp-button>
			<qp-button id="PXButton2" dialog-result="Cancel" caption="Close"></qp-button>
		</footer>
	</qp-panel>
</template>
